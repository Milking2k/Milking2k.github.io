
<!DOCTYPE html>
<html lang="zh-cn">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Jelech的博客">
    <title>TCP/IP学习笔记 - Jelech的博客</title>
    <meta name="author" content="Jelech">
    
        <meta name="keywords" content="博客,算法,javascript,游戏,">
    
    
        <link rel="icon" href="http://www.jelech.cn/assets/images/favicon.ico">
        <link rel="Shortcut Icon" type="image/x-icon" href="assets/images/favicon.ico">
    
    
        <link rel="alternate" type="application/atom+xml" title="RSS" href="/atom.xml">
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Jelech","sameAs":["https://github.com/jelech","mailto"],"image":"avatar.jpg"},"articleBody":"\n\nTCP/IP 协议(栈)笔记\n您的浏览器与服务器都在使用 TCP/IP 协议\n\n您的 E-Mail 使用 TCP/IP 协议\n\n因特网地址是 TCP/IP 协议\n\n\n网际互联及OSI七层模型：\n物理层、数据链路层、网络层、传输层、表示层、会话层、应用层\n\n物理层\n  作用：定义一些电器，机械，过程和规范，如集线器；\n  PDU(协议数据单元)：bit/比特\n  设备：集线器HUB;\n  注意：没有寻址的概念；\n\n数据链路层\n  作用：定义如何格式化数据，支持错误检测；\n  典型协议：以太网，帧中继（古董级VPN）\n  PDU：frame（帧）设备：以太网交换机；\n  备注：交换机通过MAC地址转发数据，逻辑链路控制；\n\n网络层\n  作用：定义一个逻辑的寻址，选择最佳路径传输，路由数据包；\n  典型协议：IP，IPX，ICMP,ARP(IP-&gt;MAC),IARP;\n  PDU:packet/数据包；\n  设备：路由器\n  备注：实现寻址\n\n传输层：\n  作用：提供可靠和尽力而为的传输；\n  典型协议：TCP,UDP,SPX,port(65535个端口),EIGRP,OSPF,\n  PDU:fragment 段；\n  无典型设备；\n  备注：负责网络传输和会话建立;\n\n会话层：\n  作用：控制会话，建立管理终止应用程序会话；\n  典型协议：NFS, SQL, ASP, PHP, JSP, RSVP(资源源预留协议), windows， \n  备注：负责会话建立；\n\n表示层：\n  作用：格式化数据；\n  典型协议：ASCII, JPEG. PNG, MP3. WAV, AVI, \n  备注：可以提供加密服务；\n\n应用层：\n  作用：控制应用程序；\n  典型协议：telnet, ssh, http, ftp, smtp, rip, BGP, (未完待续)\n  备注：为应用程序提供网络服务；\n\n\n在 TCP/IP 内部在 TCP/IP 中包含一系列用于处理数据通信的协议：\n\nTCP (传输控制协议) - 应用程序之间通信\nUDP (用户数据报协议) - 应用程序之间的简单通信\nIP (网际协议) - 计算机之间的通信\nICMP (因特网消息控制协议) - 针对错误和状态\nDHCP (动态主机配置协议) - 针对动态寻址\n\n当应用程序希望通过 TCP 与另一个应用程序通信时，它会发送一个通信请求。这个请求必须被送到一个确切的地址。在双方”握手”之后，TCP 将在两个应用程序之间建立一个全双工 (full-duplex) 的通信。\n这个全双工的通信将占用两个计算机之间的通信线路，直到它被一方或双方关闭为止。\nUDP 和 TCP 很相似，但是更简单，同时可靠性低于 TCP。\nIP 是无连接的协议IP 用于计算机之间的通信。\nIP 是无连接的通信协议。它不会占用两个正在通信的计算机之间的通信线路。这样，IP 就降低了对网络线路的需求。每条线可以同时满足许多不同的计算机之间的通信需要。\n通过 IP，消息（或者其他数据）被分割为小的独立的包，并通过因特网在计算机之间传送。\nIP 负责将每个包路由至它的目的地。\nIP 路由器当一个 IP 包从一台计算机被发送，它会到达一个 IP 路由器。\nIP 路由器负责将这个包路由至它的目的地，直接地或者通过其他的路由器。\n在一个相同的通信中，一个包所经由的路径可能会和其他的包不同。而路由器负责根据通信量、网络中的错误或者其他参数来进行正确地寻址。\n总结TCP/IP是什么TCP/IP 意味着 TCP 和 IP 在一起协同工作。\nTCP 负责应用软件（比如您的浏览器）和网络软件之间的通信。\nIP 负责计算机之间的通信。\nTCP 负责将数据分割并装入 IP 包，然后在它们到达的时候重新组合它们。\nIP 负责将包发送至接受者。\nTCP/IP 寻址TCP/IP 使用 32 个比特或者 4 组 0 到 255 之间的数字来为计算机编址。\nIP地址每个计算机必须有一个 IP 地址才能够连入因特网。\n每个 IP 包必须有一个地址才能够发送到另一台计算机。\n每个计算机必须有一个唯一的 4 组数字的地址，每组数字必须在 0 到 255 之间，并由点号隔开，比如：192.168.1.60\nIP V6\nIPv6 是 “Internet Protocol Version 6” 的缩写，也被称作下一代互联网协议，它是由 IETF 小组（Internet 工程任务组Internet Engineering Task Force）设计的用来替代现行的 IPv4（现行的）协议的一种新的 IP 协议。\n\n规定的标准语法建议把 IPv6 地址的 128 位（16 个字节）写成 8 个 16 位的无符号整数，每个整数用 4 个十六进制位表示，这些数之间用冒号（:）分开，例如：\n1686E：8C64：FFFF：FFFF：0：1180：96A：FFFF\n冒号十六进制记法允许零压缩，即一串连续的0可以用一对冒号取代，只能使用一次零压缩。1FF05：0：0：0：0：0：0：B3 /*可以定成：*/ FF05：：B3\n域名12 个阿拉伯数字很难记忆。使用一个名称更容易。\n用于 TCP/IP 地址的名字被称为域名。jelech.cn 就是一个域名。\n\nSSL - 安全套接字层（Secure Sockets Layer）\n  SSL 协议用于为安全数据传输加密数据。\n\nSMTP - 简易邮件传输协议（Simple Mail Transfer Protocol）\n  SMTP 用于电子邮件的传输。\n\nMIME - 多用途因特网邮件扩展（Multi-purpose Internet Mail Extensions）\n  MIME 协议使 SMTP 有能力通过 TCP/IP 网络传输多媒体文件，包括声音、视频和二进制数据。\n\nIMAP - 因特网消息访问协议（Internet Message Access Protocol）\n  IMAP 用于存储和取回电子邮件。\n\nPOP - 邮局协议（Post Office Protocol）\n  POP 用于从电子邮件服务器向个人电脑下载电子邮件。\n\nFTP - 文件传输协议（File Transfer Protocol）\n  FTP 负责计算机之间的文件传输。\n\nNTP - 网络时间协议（Network Time Protocol）\n  NTP 用于在计算机之间同步时间（钟）。\n\nDHCP - 动态主机配置协议（Dynamic Host Configuration Protocol）\n  DHCP 用于向网络中的计算机分配动态 IP 地址。\n\nSNMP - 简单网络管理协议（Simple Network Management Protocol）\n  SNMP 用于计算机网络的管理。\n\nLDAP - 轻量级的目录访问协议（Lightweight Directory Access Protocol）\n  LDAP 用于从因特网搜集关于用户和电子邮件地址的信息。\n\nICMP - 因特网消息控制协议（Internet Control Message Protocol）\n  ICMP 负责网络中的错误处理。\n\nARP - 地址解析协议（Address Resolution Protocol）\n  ARP - 用于通过 IP 来查找基于 IP 地址的计算机网卡的硬件地址。\n\nRARP - 反向地址转换协议（Reverse Address Resolution Protocol）\n  RARP 用于通过 IP 查找基于硬件地址的计算机网卡的 IP 地址。\n\nBOOTP - 自举协议（Boot Protocol）\n  BOOTP 用于从网络启动计算机。\n\nPPTP - 点对点隧道协议（Point to Point Tunneling Protocol）\n  PPTP 用于私人网络之间的连接（隧道）。\n\n\n其他知识点前提RFC\n\nRFC是什么？RFC就是tcp/ip协议的标准文档，在这里我们可以看到RFC那长长的定义列表，现在它一共有4000多个协议的定义，当然，我们所要学习的，也就是那么十几个协议而已。\n\n端口号(port)\n\n注意，这个号码是用在TCP，UDP上的一个逻辑号码，并不是一个硬件端口，我们平时说把某某端口封掉了，也只是在IP层次把带有这个号码的IP包给过滤掉了而已。\n\n环回接口（loopback）平时我们用127.0.0.1来尝试自己的机器服务器好使不好使。走的就是这个loopback接口。对于环回接口，有如下三点值得注意:\n\n传给环回地址（一般是127.0.0.1）的任何数据均作为I P输入。\n\n传给广播地址或多播地址的数据报复制一份传给环回接口，然后送到以太网上。这是 因为广播传送和多播传送的定义包含主机本身。\n\n任何传给该主机IP地址的数据均送到环回接口。\n\n\nIP、ARP、RARP协议​    \n\nARP协议用来找到目标主机的Ethernet网卡Mac地址，IP则承载要发送的消息\n\nIP协议\nTTL字段规定该数据包在穿过多少个路由之后才会被抛弃(这里就体现出来IP协议包的不可靠性，它不保证数据被送达)\n\n稍微一般一点的情况是，主机通过若干个路由器(router)和目的主机连接。那么路由器就要通过ip包的信息来为ip包寻找到一个合适的目标来进行传递，比如合适的主机，或者合适的路由。路由器或者主机将会用如下的方式来处理某一个IP数据包\n\n如果IP数据包的TTL(生命周期)已到，则该IP数据包就被抛弃。\n搜索路由表，优先搜索匹配主机，如果能找到和IP地址完全一致的目标主机，则将该包发向目标主机\n搜索路由表，如果匹配主机失败，则匹配同子网的路由器，这需要“子网掩码(1.3.)”的协助。如果找到路由器，则将该包发向路由器。\n搜索路由表，如果匹配同子网路由器失败，则匹配同网号(第一章有讲解)路由器，如果找到路由器，则将该包发向路由器。\n搜索路由表，如果以上都失败了，就搜索默认路由，如果默认路由存在，则发包\n如果都失败了，就丢掉这个包。\n\n\n子网掩码是由32bit的二进制数字序列,形式为是一连串的1和一连串的0，例如：255.255.255.0(二进制就是11111111.11111111.11111111.00000000)\n\n首部\n\n4版本、4首长度、8服务类型、16总长度、\n16标识、3标志、13位片偏移\n8生存时间TTL、8协议(1ICMP, 6TCP, 17UDP)、16位首部检验和\n32位源IP\n32位目的IP      &lt;== 20字节\n[选项]\n数据\n\n\n\nARP协议\nARP(地址解析)\n\nARP高速缓存(就是一个IP-MAC地址对应表缓存)\n\n如果查询的IP-MAC值对不存在，那么主机就向网络发送一个ARP协议广播包\n\n如果收到广播包的某一个主机发现自己符合条件，那么就准备好一个包含自己的MAC地址的ARP包传送给发送ARP广播的主机\n\n高速缓存是有时限的，一般是20分钟\n\n\nICMP协议 &amp;&amp; Ping &amp;&amp; Traceroute\n保证数据送达的工作应该由其他的模块来完成。其中一个重要的模块就是ICMP(网络控制报文)协议。\n当传送IP数据包发生错误－－比如主机不可达，路由不可达等等，ICMP协议将会把错误信息封包，然后传送回给主机。\nICMP协议大致分为两类，一种是查询报文，一种是差错报文。\nping查询（不要告诉我你不知道ping程序）\n子网掩码查询（用于无盘工作站在初始化自身的时候初始化子网掩码）\n时间戳查询（可以用来同步时间）\n\n\n\nTraceroute\nTraceroute是用来侦测主机到目的主机之间所经路由情况的重要工具，也是最便利的工具。\n\n首先给目的主机发送一个TTL=1的UDP数据包，而经过的第一个路由器收到这个数据包以后，就自动把TTL减1，而TTL变为0以后，路由器就把这个包给抛弃了，并同时产生 一个主机不可达的ICMP数据报给主机。主机收到这个数据报以后再发一个TTL=2的UDP数据报给目的主机，然后刺激第二个路由器给主机发ICMP数据 报。如此往复直到到达目的主机。这样，traceroute就拿到了所有的路由器ip。\n\n\nTCP\n利用TCP通信的两台主机首先要经历一个“拨打电话”的过程，等到通信准备结束才开始传输数据，最后结束通话。\n应用数据被分割成TCP认为最适合发送的数据块。这和UDP完全不同，应用程序产生的数据报长度将保持不变。\n当TCP发出一个段后，它启动一个定时器，等待目的端确认收到这个报文段。如果不能 及时收到一个确认，将重发这个报文段。\n当TCP收到发自TCP连接另一端的数据，它将发送一个确认。这个确认不是立即发送，通常将推迟几分之一秒。\nTCP将保持它首部和数据的检验和。这是一个端到端的检验和，目的是检测数据在传输 过程中的任何变化。如果收到段的检验和有差错， T P将丢弃这个报文段和不确认收到此报文段（希望发端超时并重发）。\nIP数据报的到达可能会失序，因此TCP报文段 的到达也可能会失序。如果必要， TCP将对收到的数据进行重新排序，将收到的数据以正确的顺序交给应用层。\nTCP还能提供流量控制。TCP连接的每一方都有固定大小的缓冲空间。TCP的接收端只允许另一端发送接收端缓冲区所能接纳的数据。这将防止较快主机致使较慢主机的缓冲区溢出。\n\nTCP建立与终止\nTCP是一个面向连接的协议，所以在连接双方发送数据之前，都需要首先建立一条连接。前面讲的所有协议都只是发送数据而已，大多数都不关心发送的数据是不是送到，UDP尤其明显，从编程的角度来说，UDP编程也要简单的多—-UDP都不用考虑数据分片。\n\nTCP连接的建立可以简单的称为三次握手，而连接的中止则可以叫做四次挥手。\n\n建立-三次握手\n客户端首先向服务器申请打开某一个端口(用SYN段等于1的TCP报文)\n服务器端发回一个ACK报文通知客户端请求报文收到\n客户端收到确认报文以后再次发出确认报文确认刚才服务器端发出的确认报文\nISN\n\n\n\n结束-4次挥手\n客户机给服务器一个FIN为1的TCP报文\n服务器返回给客户端一个确认ACK报文\n发送一个FIN报文\n客户机回复ACK报文\n\n\n\n最大报文长度\n在建立连接的时候，通信的双方要互相确认对方的最大报文长度(MSS)，以便通信。\nSYN长度是MTU减去固定IP首部和TCP首部长度。\n\nTCP交互数据流，成块数据流交互数据流\n对于交互性要求比较高的应用，TCP给出两个策略来提高发送效率和减低网络负担：（1）捎带ACK。(2)Nagle算法\n\n\n捎带ACK\n当主机收到远程主机的TCP数据报之后，通常不马上发送ACK数据报\n等上一个短暂的时间，如果这段时间里面主机还有发送到远程主机的TCP数据报，那么就把这个ACK数据报“捎带”着发送出去，把本来两个TCP数据报整合成一个发送\n\n\nNagle算法\n当主机A给主机B发送了一个TCP数据报并进入等待主机B的ACK数据报的状态时，TCP的输出缓冲区里面只能有一个TCP数据报\n这个数据报不断地收集后来的数据，整合成一个大的数据报\n等到B主机的ACK包一到，就把这些数据“一股脑”的发送出去\n\n\n\nTCP的成块数据流\n对于FTP这样对于数据吞吐量有较高要求的要求，将总是希望每次尽量多的发送数据到对方主机，就算是有点“延迟”也无所谓\n\n\nACK的应答策略：发送端将会连续发送数据尽量填满接受方的缓冲区，而接受方对这些数据只要发送一个ACK报文来回应就可以了，这就是ACK的累积特性，这个特性大大减少了发送端和接收端的负担。\n\n滑动窗口\n\n滑动窗口本质上是描述接受方的TCP数据报缓冲区大小的数据，发送方根据这个数据来计算自己最多能发送多长的数据。\n如果发送方收到接受方的窗口大小为0的TCP数据报，那么发送方将停止发送数据，等到接受方发送窗口大小不为0的数据报的到来。\n窗口协议\n窗口合拢：当窗口从左边向右边靠近的时候，这种现象发生在数据被发送和确认的时候。\n窗口张开：当窗口的右边沿向右边移动的时候，这种现象发生在接受端处理了数据以后。\n窗口收缩：当窗口的右边沿向左边移动的时候，这种现象不常发生。\nTCP就是用这个窗口，慢慢的从数据的左边移动到右边，把处于窗口范围内的数据发送出去窗口的大小是可以通过socket来制定的，4096并不是最理想的窗口大小，而16384则可以使吞吐量大大的增加。\n\n\n\n\n数据拥塞\n最大的问题就是当传输时出现了瓶颈，TCP发送方需要确认连接双方的线路的数据最大吞吐量是多少\n(倍增)\nTCP发送方首先发送一个数据报，然后等待对方的回应\n得到回应后就把这个窗口的大小加倍，然后连续发送两个数据报\n等到对方回应以后，再把这个窗口加倍\n\n\n\n\n\nTCP的超时与重传\n超时重传是TCP协议保证数据可靠性的另一个重要机制，其原理是在发送某一个数据以后就开启一个计时器，在一定时间内如果没有得到发送的数据报的ACK报文，那么就重新发送数据，直到发送成功为止。\n\n\n超时\n定时长久会造成网络利用率不高\n定时太短会造成多次重传，使得网络阻塞\n\n\n计时器的使用\n一个连接中，有且仅有一个测量定时器被使用。也就是说，如果TCP连续发出3组数据，只有一组数据会被测量。\nACK数据报不会被测量，原因很简单，没有ACK的ACK回应可以供结束定时器测量。\n\n\n重传\n拥塞窗口最初使用指数增长的速度来增加自身的窗口，直到发生超时重传，再进行一次微调。\n如何进行微调，拥塞避免算法和慢启动门限就是为此而生。\n慢启动门限就是说，当拥塞窗口超过这个门限的时候，就使用拥塞避免算法，而在门限以内就采用慢启动算法\n\n\n快速重传和快速恢复算法\n一般来说，重传发生在超时之后，但是如果发送端接受到3个以上的重复ACK的情况下，就应该意识到，数据丢了，需要重新传递\n这个机制是不需要等到重传定时器溢出的，所以叫做快速重传，而重新传递以后，因为走的不是慢启动而是拥塞避免算法，所以这又叫做快速恢复算法\n\n\n\n\n\nUDPUDP端口号\n例如某一个UDP程序A在系统中注册了3000端口，那么，以后从外面传进来的目的端口号为3000的UDP包都会交给该程序。端口号理论上可以有2^16这么多。因为它的长度是16个bit\nUDP检验和覆盖UDP协议头和数据, UDP和TCP都包含一个伪首部，这是为了计算检验和而摄制的。\n目的是让UDP两次检查数据是否已经正确到达目的地。\n\n\nUDP可以很长很长，可以有65535字节那么长。但是一般网络在传送的时候，一次一般传送不了那么长的协议（涉及到MTU的问题），就只好对数据分片\n\nIP分片\nIP在从上层接到数据以后，要根据IP地址来判断从那个接口发送数据（通过选路），并进行MTU的查询，如果数据大小超过MTU就进行数据分片。\n在IP头里面\n16bit识别号唯一记录了一个IP包的ID,具有同一个ID的IP片将会被重新组装；\n而13位片偏移则记录了某IP片相对整个包的位置；\n而这两个表示中间的3bit标志则标示着该分片后面是否还有新的分片。\n\n\n\nUDP服务器设计\n关于客户IP和地址：服务器必须有根据客户IP地址和端口号判断数据包是否合法的能力（这似乎要求每一个服务器都要具备）\n关于目的地址：服务器必须要有过滤广播地址的能力。\n关于数据输入：通常服务器系统的每一个端口号都会和一块输入缓冲区对应，进来的输入根据先来后到的原则等待服务器的处理，所以难免会出现缓冲区溢出的问题，这种情况下，UDP数据包可能会被丢弃，而应用服务器程序本身并不知道这个问题。\n服务器应该限制本地IP地址，就是说它应该可以把自己绑定到某一个网络接口的某一个端口上。\n\n广播和多播，IGMP协议单播(unicast)\n单播是说，对特定的主机进行数据传送。\n例如给某一个主机发送IP数据包。这时候，数据链路层给出的数据头里面是非常具体的目的地址，对于以太网来 说，就是网卡的MAC地址。\n\n广播(unicast)\n广播是主机针对某一个网络上的所有主机发送数据包。\n这个网络可能是网络，可能是子网，还可能是所有的子网。\n一般说来ARP，或者路由协议RIP应该是以广播的形式播发的。\n\n多播(multicast)\n多播就是给一组特定的主机（多播组）发送数据\n多播的数据还是要通过数据链路层进行MAC地址绑定然后进行发送。所以一个以太网卡在绑定了一个多播IP地址之后，必 定还要绑定一个多播的MAC地址，才能使得其可以像单播那样工作。\n\nIGMP\nIGMP的作用在于，让其他所有需要知道自己处于哪个多播组的主机和路由器知道自己的状态。\n\nDNS域名系统\n它负责把FQDN(就是以”.”分隔结尾的名字)翻译成一个IP。\nDNS系统是一个分布式的数据库，当一个数据库发现自己并没有某查询所需要的数据的时候，它将把查询转发出去，而转发的目的地通常是根服务器，根服 务器从上至下层层转发查询，直到找到目标为止。\n\n用UDP还是TCP\n而大多数的查询都是UDP查询的，一般需要TCP查询的有两种情况\n当查询数据多大以至于产生了数据截断(TC标志为1)，这时，需要利用TCP的分片能力来进行数据传输\n当主（master）服务器和辅（slave）服务器之间通信，辅服务器要拿到主服务器的zone信息的时候。\n\n\n\n","dateCreated":"2018-12-04T12:09:33+08:00","dateModified":"2018-12-08T13:26:37+08:00","datePublished":"2018-12-04T12:09:33+08:00","description":"","headline":"TCP/IP学习笔记","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"http://www.jelech.cn/posts/13277/"},"publisher":{"@type":"Organization","name":"Jelech","sameAs":["https://github.com/jelech","mailto"],"image":"avatar.jpg","logo":{"@type":"ImageObject","url":"avatar.jpg"}},"url":"http://www.jelech.cn/posts/13277/","keywords":"笔记, TCP/IP, 协议"}</script>
    <meta name="keywords" content="笔记,TCP&#x2F;IP,协议">
<meta property="og:type" content="blog">
<meta property="og:title" content="TCP&#x2F;IP学习笔记">
<meta property="og:url" content="http://www.jelech.cn/posts/13277/index.html">
<meta property="og:site_name" content="Jelech的博客">
<meta property="og:locale" content="zh-cn">
<meta property="og:updated_time" content="2018-12-08T05:26:37.656Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="TCP&#x2F;IP学习笔记">
<meta name="twitter:creator" content="@twitter">
    
    
        
    
    
        <meta property="og:image" content="http://www.jelech.cn/assets/images/avatar.jpg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style-du2xmrqdqrl2ollgeiw050kpl6l4nbyz7bumjuurjgsxyopifvukebxc9lqe.min.css">
    <!--STYLES END-->
    

    
    <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?c3b0944d9211544bb9fe9d25ce47bac7";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
    </script>

</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="4">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">Jelech的博客</a>
    </div>
    
        
            <a class="header-right-picture " href="#about">
        
        
            <img class="header-picture" src="/assets/images/avatar.jpg" alt="作者的图片">
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="4">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/avatar.jpg" alt="作者的图片">
                </a>
                <h4 class="sidebar-profile-name">Jelech</h4>
                
                    <h5 class="sidebar-profile-bio"><p>putty本无树,MinGW亦非台</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/ " title="首页">
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">首页</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-categories" title="分类">
                    
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">分类</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-tags" title="标签">
                    
                        <i class="sidebar-button-icon fa fa-tags" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">标签</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/all-archives" title="归档">
                    
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">归档</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/game" title="游戏">
                    
                        <i class="sidebar-button-icon fas fa-gamepad" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">游戏</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="#about" title="关于">
                    
                        <i class="sidebar-button-icon fa fa-question" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">关于</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="https://github.com/jelech" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a class="sidebar-button-link " href="/mailto" title="邮箱">
                    
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">邮箱</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="4"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            TCP/IP学习笔记
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2018-12-04T12:09:33+08:00">
	
		    12月 04, 2018
    	
    </time>
    
        <span>发布在 </span>
        
    <a class="category-link" href="/categories/学习笔记/">学习笔记</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            
            <h1 id="table-of-contents">目录</h1><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#TCP-IP-协议-栈-笔记"><span class="toc-text">TCP/IP 协议(栈)笔记</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#在-TCP-IP-内部"><span class="toc-text">在 TCP/IP 内部</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IP-是无连接的协议"><span class="toc-text">IP 是无连接的协议</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IP-路由器"><span class="toc-text">IP 路由器</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#总结TCP-IP是什么"><span class="toc-text">总结TCP/IP是什么</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TCP-IP-寻址"><span class="toc-text">TCP/IP 寻址</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#IP地址"><span class="toc-text">IP地址</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IP-V6"><span class="toc-text">IP V6</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#域名"><span class="toc-text">域名</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#其他知识点"><span class="toc-text">其他知识点</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#前提"><span class="toc-text">前提</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#环回接口（loopback）"><span class="toc-text">环回接口（loopback）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IP、ARP、RARP协议"><span class="toc-text">IP、ARP、RARP协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#IP协议"><span class="toc-text">IP协议</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#ARP协议"><span class="toc-text">ARP协议</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ICMP协议-amp-amp-Ping-amp-amp-Traceroute"><span class="toc-text">ICMP协议 &amp;&amp; Ping &amp;&amp; Traceroute</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Traceroute"><span class="toc-text">Traceroute</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TCP"><span class="toc-text">TCP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP建立与终止"><span class="toc-text">TCP建立与终止</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#最大报文长度"><span class="toc-text">最大报文长度</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP交互数据流，成块数据流"><span class="toc-text">TCP交互数据流，成块数据流</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#交互数据流"><span class="toc-text">交互数据流</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#TCP的成块数据流"><span class="toc-text">TCP的成块数据流</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TCP的超时与重传"><span class="toc-text">TCP的超时与重传</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#UDP"><span class="toc-text">UDP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#UDP端口号"><span class="toc-text">UDP端口号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IP分片"><span class="toc-text">IP分片</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#UDP服务器设计"><span class="toc-text">UDP服务器设计</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#广播和多播，IGMP协议"><span class="toc-text">广播和多播，IGMP协议</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#单播-unicast"><span class="toc-text">单播(unicast)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#广播-unicast"><span class="toc-text">广播(unicast)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#多播-multicast"><span class="toc-text">多播(multicast)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IGMP"><span class="toc-text">IGMP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DNS域名系统"><span class="toc-text">DNS域名系统</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#用UDP还是TCP"><span class="toc-text">用UDP还是TCP</span></a></li></ol></li></ol></li></ol>
<a id="more"></a>
<h1 id="TCP-IP-协议-栈-笔记"><a href="#TCP-IP-协议-栈-笔记" class="headerlink" title="TCP/IP 协议(栈)笔记"></a>TCP/IP 协议(栈)笔记</h1><ul>
<li><p>您的浏览器与服务器都在使用 TCP/IP 协议</p>
</li>
<li><p>您的 E-Mail 使用 TCP/IP 协议</p>
</li>
<li><p>因特网地址是 TCP/IP 协议</p>
</li>
</ul>
<p>网际互联及OSI七层模型：</p>
<p>物理层、数据链路层、网络层、传输层、表示层、会话层、应用层</p>
<ul>
<li><p>物理层</p>
<p>  作用：定义一些电器，机械，过程和规范，如集线器；</p>
<p>  PDU(协议数据单元)：bit/比特</p>
<p>  设备：集线器HUB;</p>
<p>  注意：没有寻址的概念；</p>
</li>
<li><p><strong>数据链路层</strong></p>
<p>  作用：定义如何格式化数据，支持错误检测；</p>
<p>  典型协议：以太网，帧中继（古董级VPN）</p>
<p>  PDU：frame（帧）设备：以太网交换机；</p>
<p>  备注：交换机通过MAC地址转发数据，逻辑链路控制；</p>
</li>
<li><p><strong>网络层</strong></p>
<p>  作用：定义一个逻辑的寻址，选择最佳路径传输，路由数据包；</p>
<p>  典型协议：IP，IPX，ICMP,ARP(IP-&gt;MAC),IARP;</p>
<p>  PDU:packet/数据包；</p>
<p>  设备：路由器</p>
<p>  备注：实现寻址</p>
</li>
<li><p><strong>传输层</strong>：</p>
<p>  作用：提供可靠和尽力而为的传输；</p>
<p>  典型协议：TCP,UDP,SPX,port(65535个端口),EIGRP,OSPF,</p>
<p>  PDU:fragment 段；</p>
<p>  无典型设备；</p>
<p>  备注：负责网络传输和会话建立;</p>
</li>
<li><p>会话层：</p>
<p>  作用：控制会话，建立管理终止应用程序会话；</p>
<p>  典型协议：NFS, SQL, ASP, PHP, JSP, RSVP(资源源预留协议), windows， </p>
<p>  备注：负责会话建立；</p>
</li>
<li><p>表示层：</p>
<p>  作用：格式化数据；</p>
<p>  典型协议：ASCII, JPEG. PNG, MP3. WAV, AVI, </p>
<p>  备注：可以提供加密服务；</p>
</li>
<li><p><strong>应用层：</strong></p>
<p>  作用：控制应用程序；</p>
<p>  典型协议：telnet, ssh, http, ftp, smtp, rip, BGP, (未完待续)</p>
<p>  备注：为应用程序提供网络服务；</p>
</li>
</ul>
<h2 id="在-TCP-IP-内部"><a href="#在-TCP-IP-内部" class="headerlink" title="在 TCP/IP 内部"></a>在 TCP/IP 内部</h2><p>在 TCP/IP 中包含一系列用于处理数据通信的协议：</p>
<ul>
<li>TCP (传输控制协议) - 应用程序之间通信</li>
<li>UDP (用户数据报协议) - 应用程序之间的简单通信</li>
<li>IP (网际协议) - 计算机之间的通信</li>
<li>ICMP (因特网消息控制协议) - 针对错误和状态</li>
<li>DHCP (动态主机配置协议) - 针对动态寻址</li>
</ul>
<p>当应用程序希望通过 TCP 与另一个应用程序通信时，它会发送一个通信请求。这个请求必须被送到一个确切的地址。在双方”握手”之后，TCP 将在两个应用程序之间建立一个全双工 (full-duplex) 的通信。</p>
<p>这个全双工的通信将占用两个计算机之间的通信线路，直到它被一方或双方关闭为止。</p>
<p>UDP 和 TCP 很相似，但是更简单，同时可靠性低于 TCP。</p>
<h3 id="IP-是无连接的协议"><a href="#IP-是无连接的协议" class="headerlink" title="IP 是无连接的协议"></a>IP 是无连接的协议</h3><p>IP 用于计算机之间的通信。</p>
<p>IP 是无连接的通信协议。它不会占用两个正在通信的计算机之间的通信线路。这样，IP 就降低了对网络线路的需求。每条线可以同时满足许多不同的计算机之间的通信需要。</p>
<p>通过 IP，消息（或者其他数据）被<code>分割为小的独立的包</code>，并通过因特网在计算机之间传送。</p>
<p>IP 负责将每个包<strong>路由</strong>至它的目的地。</p>
<h3 id="IP-路由器"><a href="#IP-路由器" class="headerlink" title="IP 路由器"></a>IP 路由器</h3><p>当一个 IP 包从一台计算机被发送，它会到达一个 IP 路由器。</p>
<p>IP 路由器负责将这个包路由至它的目的地，直接地或者通过其他的路由器。</p>
<p><strong>在一个相同的通信中，一个包所经由的路径可能会和其他的包不同</strong>。而路由器负责根据通信量、网络中的错误或者其他参数来进行正确地寻址。</p>
<h3 id="总结TCP-IP是什么"><a href="#总结TCP-IP是什么" class="headerlink" title="总结TCP/IP是什么"></a>总结TCP/IP是什么</h3><p>TCP/IP 意味着 TCP 和 IP 在一起协同工作。</p>
<p>TCP 负责应用软件（比如您的浏览器）和网络软件之间的通信。</p>
<p>IP 负责计算机之间的通信。</p>
<p>TCP 负责将数据分割并装入 IP 包，然后在它们到达的时候重新组合它们。</p>
<p>IP 负责将包发送至接受者。</p>
<h2 id="TCP-IP-寻址"><a href="#TCP-IP-寻址" class="headerlink" title="TCP/IP 寻址"></a>TCP/IP 寻址</h2><p>TCP/IP 使用 32 个比特或者 4 组 0 到 255 之间的数字来为计算机编址。</p>
<h3 id="IP地址"><a href="#IP地址" class="headerlink" title="IP地址"></a>IP地址</h3><p>每个计算机必须有一个 IP 地址才能够连入因特网。</p>
<p>每个 IP 包必须有一个地址才能够发送到另一台计算机。</p>
<p>每个计算机必须有一个唯一的 4 组数字的地址，每组数字必须在 0 到 255 之间，并由点号隔开，比如：<code>192.168.1.60</code></p>
<h3 id="IP-V6"><a href="#IP-V6" class="headerlink" title="IP V6"></a>IP V6</h3><blockquote>
<p>IPv6 是 “Internet Protocol Version 6” 的缩写，也被称作下一代互联网协议，它是由 IETF 小组（Internet 工程任务组Internet Engineering Task Force）设计的用来替代现行的 IPv4（现行的）协议的一种新的 IP 协议。</p>
</blockquote>
<p>规定的标准语法建议把 IPv6 地址的 128 位（16 个字节）写成 8 个 16 位的无符号整数，每个整数用 4 个十六进制位表示，这些数之间用冒号（:）分开，例如：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">686</span>E：<span class="number">8</span>C64：FFFF：FFFF：<span class="number">0</span>：<span class="number">1180</span>：<span class="number">96</span>A：FFFF</span><br></pre></td></tr></table></figure>
<p>冒号十六进制记法允许零压缩，即一串连续的0可以用一对冒号取代，只能使用一次零压缩。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">FF05：0：0：0：0：0：0：B3 /*可以定成：*/ FF05：：B3</span><br></pre></td></tr></table></figure></p>
<h3 id="域名"><a href="#域名" class="headerlink" title="域名"></a>域名</h3><p>12 个阿拉伯数字很难记忆。使用一个名称更容易。</p>
<p>用于 TCP/IP 地址的名字被称为域名。jelech.cn 就是一个域名。</p>
<ul>
<li><p><code>SSL</code> - 安全套接字层（Secure Sockets Layer）</p>
<p>  SSL 协议用于为安全数据传输加密数据。</p>
</li>
<li><p><code>SMTP</code> - 简易邮件传输协议（Simple Mail Transfer Protocol）</p>
<p>  SMTP 用于电子邮件的传输。</p>
</li>
<li><p><code>MIME</code> - 多用途因特网邮件扩展（Multi-purpose Internet Mail Extensions）</p>
<p>  MIME 协议使 SMTP 有能力通过 TCP/IP 网络传输多媒体文件，包括声音、视频和二进制数据。</p>
</li>
<li><p><code>IMAP</code> - 因特网消息访问协议（Internet Message Access Protocol）</p>
<p>  IMAP 用于存储和取回电子邮件。</p>
</li>
<li><p>POP - 邮局协议（Post Office Protocol）</p>
<p>  POP 用于从电子邮件服务器向个人电脑下载电子邮件。</p>
</li>
<li><p><code>FTP</code> - 文件传输协议（File Transfer Protocol）</p>
<p>  FTP 负责计算机之间的文件传输。</p>
</li>
<li><p><code>NTP</code> - 网络时间协议（Network Time Protocol）</p>
<p>  NTP 用于在计算机之间同步时间（钟）。</p>
</li>
<li><p><code>DHCP</code> - 动态主机配置协议（Dynamic Host Configuration Protocol）</p>
<p>  DHCP 用于向网络中的计算机分配动态 IP 地址。</p>
</li>
<li><p>SNMP - 简单网络管理协议（Simple Network Management Protocol）</p>
<p>  SNMP 用于计算机网络的管理。</p>
</li>
<li><p>LDAP - 轻量级的目录访问协议（Lightweight Directory Access Protocol）</p>
<p>  LDAP 用于从因特网搜集关于用户和电子邮件地址的信息。</p>
</li>
<li><p><code>ICMP</code> - 因特网消息控制协议（Internet Control Message Protocol）</p>
<p>  ICMP 负责网络中的错误处理。</p>
</li>
<li><p><code>ARP</code> - 地址解析协议（Address Resolution Protocol）</p>
<p>  ARP - 用于通过 IP 来查找基于 IP 地址的计算机网卡的硬件地址。</p>
</li>
<li><p>RARP - 反向地址转换协议（Reverse Address Resolution Protocol）</p>
<p>  RARP 用于通过 IP 查找基于硬件地址的计算机网卡的 IP 地址。</p>
</li>
<li><p>BOOTP - 自举协议（Boot Protocol）</p>
<p>  BOOTP 用于从网络启动计算机。</p>
</li>
<li><p><code>PPTP</code> - 点对点隧道协议（Point to Point Tunneling Protocol）</p>
<p>  PPTP 用于私人网络之间的连接（隧道）。</p>
</li>
</ul>
<h2 id="其他知识点"><a href="#其他知识点" class="headerlink" title="其他知识点"></a>其他知识点</h2><h3 id="前提"><a href="#前提" class="headerlink" title="前提"></a>前提</h3><p><strong>RFC</strong></p>
<ul>
<li>RFC是什么？RFC就是tcp/ip协议的标准文档，在<a href="http://www.ietf.org/iesg/1rfc_index.txt" target="_blank" rel="noopener">这里</a>我们可以看到RFC那长长的定义列表，现在它一共有4000多个协议的定义，当然，我们所要学习的，也就是那么十几个协议而已。</li>
</ul>
<p><strong>端口号</strong>(port)</p>
<ul>
<li>注意，这个号码是用在TCP，UDP上的一个逻辑号码，并不是一个硬件端口，我们平时说把某某端口封掉了，也只是在IP层次把带有这个号码的IP包给过滤掉了而已。</li>
</ul>
<h3 id="环回接口（loopback）"><a href="#环回接口（loopback）" class="headerlink" title="环回接口（loopback）"></a>环回接口（loopback）</h3><p>平时我们用127.0.0.1来尝试自己的机器服务器好使不好使。走的就是这个loopback接口。对于环回接口，有如下三点值得注意:</p>
<ul>
<li><p>传给环回地址（一般是127.0.0.1）的任何数据均作为I P输入。</p>
</li>
<li><p>传给广播地址或多播地址的数据报复制一份传给环回接口，然后送到以太网上。这是 因为广播传送和多播传送的定义包含主机本身。</p>
</li>
<li><p>任何传给该主机IP地址的数据均送到环回接口。</p>
</li>
</ul>
<h3 id="IP、ARP、RARP协议"><a href="#IP、ARP、RARP协议" class="headerlink" title="IP、ARP、RARP协议"></a>IP、ARP、RARP协议</h3><p>​    </p>
<ul>
<li>ARP协议用来找到目标主机的Ethernet网卡Mac地址，IP则承载要发送的消息</li>
</ul>
<h4 id="IP协议"><a href="#IP协议" class="headerlink" title="IP协议"></a>IP协议</h4><ul>
<li><p>TTL字段规定该数据包在穿过多少个路由之后才会被抛弃(这里就体现出来IP协议包的不可靠性，它不保证数据被送达)</p>
</li>
<li><p>稍微一般一点的情况是，主机通过若干个路由器(router)和目的主机连接。那么路由器就要通过ip包的信息来为ip包寻找到一个合适的目标来进行传递，比如合适的主机，或者合适的路由。路由器或者主机将会用如下的方式来处理某一个IP数据包</p>
<ul>
<li>如果IP数据包的TTL(生命周期)已到，则该IP数据包就被抛弃。</li>
<li>搜索路由表，优先搜索匹配主机，如果能找到和IP地址完全一致的目标主机，则将该包发向目标主机</li>
<li>搜索路由表，如果匹配主机失败，则匹配同子网的路由器，这需要“子网掩码(1.3.)”的协助。如果找到路由器，则将该包发向路由器。</li>
<li>搜索路由表，如果匹配同子网路由器失败，则匹配同网号(第一章有讲解)路由器，如果找到路由器，则将该包发向路由器。</li>
<li>搜索路由表，如果以上都失败了，就搜索默认路由，如果默认路由存在，则发包</li>
<li>如果都失败了，就丢掉这个包。</li>
</ul>
</li>
<li><p>子网掩码是由32bit的二进制数字序列,形式为是一连串的1和一连串的0，例如：255.255.255.0(二进制就是11111111.11111111.11111111.00000000)</p>
</li>
<li><p><strong>首部</strong></p>
<ul>
<li>4版本、4首长度、8服务类型、16总长度、</li>
<li>16标识、3标志、13位片偏移</li>
<li>8生存时间TTL、8协议(1ICMP, 6TCP, 17UDP)、16位首部检验和</li>
<li>32位源IP</li>
<li>32位目的IP      &lt;== 20字节</li>
<li>[选项]</li>
<li>数据</li>
</ul>
</li>
</ul>
<h4 id="ARP协议"><a href="#ARP协议" class="headerlink" title="ARP协议"></a>ARP协议</h4><ul>
<li><p>ARP(地址解析)</p>
</li>
<li><p>ARP高速缓存(就是一个IP-MAC地址对应表缓存)</p>
</li>
<li><p>如果查询的IP-MAC值对不存在，那么主机就向网络发送一个ARP协议广播包</p>
</li>
<li><p>如果收到广播包的某一个主机发现自己符合条件，那么就准备好一个包含自己的MAC地址的ARP包传送给发送ARP广播的主机</p>
</li>
<li><p>高速缓存是有时限的，一般是20分钟</p>
</li>
</ul>
<h3 id="ICMP协议-amp-amp-Ping-amp-amp-Traceroute"><a href="#ICMP协议-amp-amp-Ping-amp-amp-Traceroute" class="headerlink" title="ICMP协议 &amp;&amp; Ping &amp;&amp; Traceroute"></a>ICMP协议 &amp;&amp; Ping &amp;&amp; Traceroute</h3><ul>
<li>保证数据送达的工作应该由其他的模块来完成。其中一个重要的模块就是ICMP(网络控制报文)协议。</li>
<li>当传送IP数据包发生错误－－比如主机不可达，路由不可达等等，ICMP协议将会把错误信息封包，然后传送回给主机。</li>
<li>ICMP协议大致分为两类，一种是查询报文，一种是差错报文。<ul>
<li>ping查询（不要告诉我你不知道ping程序）</li>
<li>子网掩码查询（用于无盘工作站在初始化自身的时候初始化子网掩码）</li>
<li>时间戳查询（可以用来同步时间）</li>
</ul>
</li>
</ul>
<h4 id="Traceroute"><a href="#Traceroute" class="headerlink" title="Traceroute"></a>Traceroute</h4><ul>
<li><p>Traceroute是用来侦测主机到目的主机之间所经路由情况的重要工具，也是最便利的工具。</p>
</li>
<li><p>首先给目的主机<strong>发送</strong>一个TTL=1的UDP数据包，而经过的第一个路由器收到这个数据包以后，就自动把<strong>TTL减1</strong>，而TTL<strong>变为0</strong>以后，路由器就把这个包给<strong>抛弃</strong>了，并同时产生 一个主机<strong>不可达的ICMP数据报</strong>给主机。主机收到这个数据报以后<strong>再发一个TTL=2</strong>的UDP数据报给目的主机，然后刺激第二个路由器给主机发ICMP数据 报。如此往复直到到达目的主机。这样，traceroute就拿到了<strong>所有</strong>的路由器ip。</p>
</li>
</ul>
<h2 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h2><ul>
<li>利用TCP通信的两台主机首先要经历一个“<strong>拨打电话</strong>”的过程，等到通信准备结束才开始传输数据，最后结束通话。</li>
<li>应用数据被分割成TCP认为最适合发送的数据块。这和UDP完全不同，应用程序产生的数据报<strong>长度</strong>将保持不变。</li>
<li>当TCP发出一个段后，它启动一个<strong>定时器</strong>，等待目的端确认收到这个报文段。如果不能 及时收到一个确认，将重发这个报文段。</li>
<li>当TCP收到发自TCP连接另一端的数据，它将发送一个<strong>确认</strong>。这个确认不是立即发送，通常将推迟几分之一秒。</li>
<li>TCP将保持它首部和数据的<strong>检验和</strong>。这是一个端到端的检验和，目的是检测数据在传输 过程中的任何变化。如果收到段的检验和有差错， T P将丢弃这个报文段和不确认收到此报文段（希望发端超时并重发）。</li>
<li>IP数据报的到达可能会失序，因此TCP报文段 的到达也可能会失序。如果必要， TCP将对收到的数据进行重新排序，将收到的数据以<strong>正确的顺序</strong>交给应用层。</li>
<li>TCP还能提供<strong>流量控制</strong>。TCP连接的每一方都有固定大小的缓冲空间。TCP的接收端只允许另一端发送接收端缓冲区所能接纳的数据。这将防止较快主机致使较慢主机的缓冲区溢出。</li>
</ul>
<h3 id="TCP建立与终止"><a href="#TCP建立与终止" class="headerlink" title="TCP建立与终止"></a>TCP建立与终止</h3><blockquote>
<p>TCP是一个面向连接的协议，所以在连接双方发送数据之前，都需要首先建立一条连接。前面讲的所有协议都只是发送数据而已，大多数都不关心发送的数据是不是送到，UDP尤其明显，从编程的角度来说，UDP编程也要简单的多—-UDP都不用考虑数据分片。</p>
</blockquote>
<p>TCP连接的建立可以简单的称为<strong>三次握手</strong>，而连接的中止则可以叫做<strong>四次挥手</strong>。</p>
<ul>
<li>建立-三次握手<ul>
<li>客户端首先向服务器<strong>申请打</strong>开某一个端口(用SYN段等于1的TCP报文)</li>
<li>服务器端发回一个<strong>ACK报文</strong>通知客户端请求报文收到</li>
<li>客户端收到确认报文以后再次发出<strong>确认报文</strong>确认刚才服务器端发出的确认报文</li>
<li>ISN</li>
<li></li>
</ul>
</li>
<li>结束-4次挥手<ul>
<li>客户机给服务器一个FIN为1的TCP报文</li>
<li>服务器返回给客户端一个确认ACK报文</li>
<li>发送一个FIN报文</li>
<li>客户机回复ACK报文</li>
</ul>
</li>
</ul>
<h4 id="最大报文长度"><a href="#最大报文长度" class="headerlink" title="最大报文长度"></a>最大报文长度</h4><ul>
<li>在建立连接的时候，通信的双方要互相确认对方的最大报文长度(MSS)，以便通信。</li>
<li>SYN长度是MTU减去固定IP首部和TCP首部长度。</li>
</ul>
<h3 id="TCP交互数据流，成块数据流"><a href="#TCP交互数据流，成块数据流" class="headerlink" title="TCP交互数据流，成块数据流"></a>TCP交互数据流，成块数据流</h3><h4 id="交互数据流"><a href="#交互数据流" class="headerlink" title="交互数据流"></a>交互数据流</h4><blockquote>
<p>对于交互性要求比较高的应用，TCP给出两个策略来提高发送效率和减低网络负担：（1）捎带ACK。(2)Nagle算法</p>
</blockquote>
<ul>
<li>捎带ACK<ul>
<li>当<strong>主机收到远程主机</strong>的TCP数据报之后，通常不马上发送ACK数据报</li>
<li>等上一个短暂的时间，如果这段时间里面<strong>主机还有发送到远程主机</strong>的TCP数据报，那么就把这个ACK数据报“捎带”着发送出去，把本来两个TCP数据报整合成一个发送</li>
</ul>
</li>
<li>Nagle算法<ul>
<li>当主机A给主机B发送了一个TCP数据报并进入等待主机B的ACK数据报的状态时，TCP的输出缓冲区里面只能有一个TCP数据报</li>
<li>这个数据报不断地收集后来的数据，整合成一个大的数据报</li>
<li>等到B主机的ACK包一到，就把这些数据“一股脑”的发送出去</li>
</ul>
</li>
</ul>
<h4 id="TCP的成块数据流"><a href="#TCP的成块数据流" class="headerlink" title="TCP的成块数据流"></a>TCP的成块数据流</h4><blockquote>
<p>对于FTP这样对于数据吞吐量有较高要求的要求，将总是希望每次尽量多的发送数据到对方主机，就算是有点“延迟”也无所谓</p>
</blockquote>
<ul>
<li><p><strong>ACK的应答策略：</strong>发送端将会连续发送数据尽量填满接受方的缓冲区，而接受方对这些数据只要发送一个ACK报文来回应就可以了，这就是ACK的累积特性，这个特性大大减少了发送端和接收端的负担。</p>
</li>
<li><p><strong>滑动窗口</strong></p>
<ul>
<li>滑动窗口本质上是<strong>描述</strong>接受方的TCP数据报<strong>缓冲区大小</strong>的数据，发送方根据这个数据来计算自己最多能发送多长的数据。</li>
<li>如果发送方收到接受方的窗口大小为0的TCP数据报，那么发送方将停止发送数据，等到接受方发送窗口大小不为0的数据报的到来。</li>
<li>窗口协议<ul>
<li>窗口合拢：当窗口从左边向右边靠近的时候，这种现象发生在数据被发送和确认的时候。</li>
<li>窗口张开：当窗口的右边沿向右边移动的时候，这种现象发生在接受端处理了数据以后。</li>
<li>窗口收缩：当窗口的右边沿向左边移动的时候，这种现象不常发生。</li>
<li>TCP就是用这个窗口，慢慢的从数据的左边移动到右边，把处于窗口范围内的数据发送出去窗口的大小是可以通过socket来制定的，4096并不是最理想的窗口大小，而16384则可以使吞吐量大大的增加。</li>
</ul>
</li>
</ul>
</li>
<li><strong>数据拥塞</strong><ul>
<li>最大的问题就是当传输时出现了瓶颈，TCP发送方需要确认连接双方的线路的数据最大吞吐量是多少<ul>
<li>(倍增)</li>
<li>TCP发送方首先发送一个数据报，然后等待对方的回应</li>
<li>得到回应后就把这个窗口的大小加倍，然后连续发送两个数据报</li>
<li>等到对方回应以后，再把这个窗口加倍</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="TCP的超时与重传"><a href="#TCP的超时与重传" class="headerlink" title="TCP的超时与重传"></a>TCP的超时与重传</h3><blockquote>
<p>超时重传是TCP协议保证数据可靠性的另一个重要机制，其原理是在发送某一个数据以后就<strong>开启一个计时器</strong>，在一定时间内如果没有得到发送的数据报的ACK报文，那么就重新发送数据，直到发送成功为止。</p>
</blockquote>
<ul>
<li>超时<ul>
<li>定时长久会造成网络利用率不高</li>
<li>定时太短会造成多次重传，使得网络阻塞</li>
</ul>
</li>
<li>计时器的使用<ul>
<li>一个连接中，有且仅有一个测量定时器被使用。也就是说，如果TCP连续发出3组数据，只有一组数据会被测量。</li>
<li>ACK数据报不会被测量，原因很简单，没有ACK的ACK回应可以供结束定时器测量。</li>
</ul>
</li>
<li>重传<ul>
<li>拥塞窗口最初使用指数增长的速度来增加自身的窗口，直到发生超时重传，再进行一次微调。</li>
<li>如何进行微调，拥塞避免算法和慢启动门限就是为此而生。<ul>
<li>慢启动门限就是说，当拥塞窗口超过这个门限的时候，就使用拥塞避免算法，而在门限以内就采用慢启动算法</li>
</ul>
</li>
<li>快速重传和快速恢复算法<ul>
<li>一般来说，重传发生在超时之后，但是如果发送端接受到3个以上的重复ACK的情况下，就应该意识到，数据丢了，需要重新传递</li>
<li>这个机制是不需要等到重传定时器溢出的，所以叫做<strong>快速重传</strong>，而重新传递以后，因为走的不是<strong>慢启动</strong>而是<strong>拥塞避免算法</strong>，所以这又叫做<strong>快速恢复算法</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h2><h3 id="UDP端口号"><a href="#UDP端口号" class="headerlink" title="UDP端口号"></a>UDP端口号</h3><ul>
<li>例如某一个UDP程序A在系统中注册了3000端口，那么，以后从外面传进来的目的端口号为3000的UDP包都会交给该程序。端口号理论上可以有2^16这么多。因为它的长度是16个bit</li>
<li>UDP检验和覆盖UDP协议头和数据, UDP和TCP都包含一个伪首部，这是为了计算检验和而摄制的。</li>
<li>目的是让UDP两次检查数据是否已经正确到达目的地。</li>
</ul>
<blockquote>
<p>UDP可以很长很长，可以有65535字节那么长。但是一般网络在传送的时候，一次一般传送不了那么长的协议（涉及到MTU的问题），就只好对数据分片</p>
</blockquote>
<h3 id="IP分片"><a href="#IP分片" class="headerlink" title="IP分片"></a>IP分片</h3><ul>
<li>IP在从上层接到数据以后，要根据IP地址来判断从那个接口发送数据（通过选路），并进行MTU的查询，如果数据大小超过MTU就进行数据分片。</li>
<li>在IP头里面<ul>
<li>16bit识别号唯一记录了一个IP包的ID,具有同一个ID的IP片将会被重新组装；</li>
<li>而13位片偏移则记录了某IP片相对整个包的位置；</li>
<li>而这两个表示中间的3bit标志则标示着该分片后面是否还有新的分片。</li>
</ul>
</li>
</ul>
<h3 id="UDP服务器设计"><a href="#UDP服务器设计" class="headerlink" title="UDP服务器设计"></a>UDP服务器设计</h3><ul>
<li>关于客户IP和地址：服务器必须有根据客户IP地址和端口号判断数据包是否合法的能力（这似乎要求每一个服务器都要具备）</li>
<li>关于目的地址：服务器必须要有过滤广播地址的能力。</li>
<li>关于数据输入：通常服务器系统的每一个端口号都会和一块输入缓冲区对应，进来的输入根据先来后到的原则等待服务器的处理，所以难免会出现缓冲区溢出的问题，这种情况下，UDP数据包可能会被丢弃，而应用服务器程序本身并不知道这个问题。</li>
<li>服务器应该限制本地IP地址，就是说它应该可以把自己绑定到某一个网络接口的某一个端口上。</li>
</ul>
<h2 id="广播和多播，IGMP协议"><a href="#广播和多播，IGMP协议" class="headerlink" title="广播和多播，IGMP协议"></a>广播和多播，IGMP协议</h2><h3 id="单播-unicast"><a href="#单播-unicast" class="headerlink" title="单播(unicast)"></a>单播(unicast)</h3><ul>
<li>单播是说，对特定的主机进行数据传送。</li>
<li>例如给某一个主机发送IP数据包。这时候，数据链路层给出的数据头里面是非常具体的目的地址，对于以太网来 说，就是网卡的MAC地址。</li>
</ul>
<h3 id="广播-unicast"><a href="#广播-unicast" class="headerlink" title="广播(unicast)"></a>广播(unicast)</h3><ul>
<li>广播是主机针对某一个网络上的所有主机发送数据包。</li>
<li>这个网络可能是网络，可能是子网，还可能是所有的子网。</li>
<li>一般说来ARP，或者路由协议RIP应该是以广播的形式播发的。</li>
</ul>
<h3 id="多播-multicast"><a href="#多播-multicast" class="headerlink" title="多播(multicast)"></a>多播(multicast)</h3><ul>
<li>多播就是给一组特定的主机（多播组）发送数据</li>
<li>多播的数据还是要通过数据链路层进行MAC地址绑定然后进行发送。所以一个以太网卡在绑定了一个多播IP地址之后，必 定还要绑定一个多播的MAC地址，才能使得其可以像单播那样工作。</li>
</ul>
<h3 id="IGMP"><a href="#IGMP" class="headerlink" title="IGMP"></a>IGMP</h3><ul>
<li>IGMP的作用在于，让其他所有需要知道自己处于哪个多播组的主机和路由器知道自己的状态。</li>
</ul>
<h2 id="DNS域名系统"><a href="#DNS域名系统" class="headerlink" title="DNS域名系统"></a>DNS域名系统</h2><ul>
<li>它负责把FQDN(就是以”.”分隔结尾的名字)翻译成一个IP。</li>
<li>DNS系统是一个分布式的数据库，当一个数据库发现自己并没有某查询所需要的数据的时候，它将把查询转发出去，而转发的目的地通常是根服务器，根服 务器从上至下层层转发查询，直到找到目标为止。</li>
</ul>
<h3 id="用UDP还是TCP"><a href="#用UDP还是TCP" class="headerlink" title="用UDP还是TCP"></a>用UDP还是TCP</h3><ul>
<li>而大多数的查询都是UDP查询的，一般需要TCP查询的有两种情况<ul>
<li>当查询数据多大以至于产生了数据截断(TC标志为1)，这时，需要利用TCP的分片能力来进行数据传输</li>
<li>当主（master）服务器和辅（slave）服务器之间通信，辅服务器要拿到主服务器的zone信息的时候。</li>
</ul>
</li>
</ul>

            

        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">标签</span><br>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/TCP-IP/">TCP/IP</a> <a class="tag tag--primary tag--small t-link" href="/tags/协议/">协议</a> <a class="tag tag--primary tag--small t-link" href="/tags/笔记/">笔记</a>

            </div>
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/posts/45237/" data-tooltip="学习的阻碍" aria-label="上一篇: 学习的阻碍">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/posts/864/" data-tooltip="HTTP学习笔记" aria-label="下一篇: HTTP学习笔记">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="分享">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://www.jelech.cn/posts/13277/" title="分享到 Facebook">
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://www.jelech.cn/posts/13277/" title="分享到 Twitter">
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://www.jelech.cn/posts/13277/" title="分享到 Google+">
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="目录">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <style media="screen">.v .vwrap{overflow: inherit;}</style>
                <div id="vcomment"></div>
                <a href="posts/13277/#vcomment" class="disqus-comment-count"></a>
                <span class="valine-comment-count" data-xid="posts/13277/"></span>
                <span> Comment</span>
            
        
    </div>
</article>


                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2018 Jelech. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/posts/45237/" data-tooltip="学习的阻碍" aria-label="上一篇: 学习的阻碍">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">上一篇</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/posts/864/" data-tooltip="HTTP学习笔记" aria-label="下一篇: HTTP学习笔记">
                
                    <span class="hide-xs hide-sm text-small icon-mr">下一篇</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="分享">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://www.jelech.cn/posts/13277/" title="分享到 Facebook">
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://www.jelech.cn/posts/13277/" title="分享到 Twitter">
                    <i class="fab fa-twitter" aria-hidden="true"></i>
                </a>
            </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://www.jelech.cn/posts/13277/" title="分享到 Google+">
                    <i class="fab fa-google-plus" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#table-of-contents" aria-label="目录">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="4">
    <i id="btn-close-shareoptions" class="fa fa-times"></i>
    <ul class="share-options">
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://www.jelech.cn/posts/13277/">
                    <i class="fab fa-facebook" aria-hidden="true"></i><span>分享到 Facebook</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http://www.jelech.cn/posts/13277/">
                    <i class="fab fa-twitter" aria-hidden="true"></i><span>分享到 Twitter</span>
                </a>
            </li>
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=http://www.jelech.cn/posts/13277/">
                    <i class="fab fa-google-plus" aria-hidden="true"></i><span>分享到 Google+</span>
                </a>
            </li>
        
    </ul>
</div>

            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/avatar.jpg" alt="作者的图片">
        
            <h4 id="about-card-name">Jelech</h4>
        
            <div id="about-card-bio"><p>putty本无树,MinGW亦非台</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br>
                <p>在校大学生一枚</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br>
                CHINA.HRB.STU
            </div>
        

        
            <div id="about-card-job">
                <i class="fa fa-envelope"></i>
                <br>
                jelech@hotmail.com
            </div>
        

        
            <div id="about-card-job">
                <i class="fa fa-phone-square"></i>
                <br>
                18.......6
            </div>
        


    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/script-vufjrm3fmbuttogo1hxuu0w9w0sesk5iyysjuguc2hdhufot9szxg8twijry.min.js"></script>
<!--SCRIPTS END-->

    
        
        <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js" charset="utf-8"></script>
        <script src="//unpkg.com/valine@latest/dist/Valine.min.js" charset="utf-8"></script>
        <script>
            var notify = 'false' == true ? true : false;
            var verify = 'false' == true ? true : false;
            var GUEST_INFO = ['nick','mail','link'];
            var guest_info = 'nick,mail,link'.split(',').filter(function(item){
                return GUEST_INFO.indexOf(item) > -1;
            });

            guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
            window.valine = new Valine({
                el:'#vcomment',
                notify:notify,
                verify:verify,
                appId:'rwwVeUe3kpfbc0OkoxmgnTKM-gzGzoHsz',
                appKey:'FcDDW6bpbs5QmH3A1B2Aqmae',
                placeholder:'Just so so',
                avatar:'mm',
                guest_info:guest_info,
                pageSize:'10'
            });
        </script>
    



    </body>
</html>
